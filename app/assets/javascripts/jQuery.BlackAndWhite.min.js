/**
 *
 * Version: 0.2.5
 * Author:  Gianluca Guarini
 * Contact: gianluca.guarini@gmail.com
 * Website: http://www.gianlucaguarini.com/
 * Twitter: @gianlucaguarini
 *
 * Copyright (c) 2013 Gianluca Guarini
 */
;(function(a){a.fn.extend({BlackAndWhite:function(i){var v=this,m={hoverEffect:true,webworkerPath:false,responsive:true,invertHoverEffect:false,speed:500};i=a.extend(m,i);var j=i.hoverEffect,f=i.webworkerPath,c=i.invertHoverEffect,h=i.responsive,z=a.isPlainObject(i.speed)?i.speed.fadeIn:i.speed,r=a.isPlainObject(i.speed)?i.speed.fadeOut:i.speed;var s=(document.all&&!window.opera&&window.XMLHttpRequest)?true:false;var e=" -webkit- -moz- -o- -ms- ".split(" ");var g={};var y=function(C){if(g[C]||g[C]===""){return g[C]+C}var D=document.createElement("div");var B=["","Moz","Webkit","O","ms","Khtml"];for(var A in B){if(typeof D.style[B[A]+C]!=="undefined"){g[C]=B[A];return B[A]+C}}return C.toLowerCase()};var t=function(){var A=document.createElement("div");A.style.cssText=e.join("filter:blur(2px); ");return !!A.style.length&&((document.documentMode===undefined||document.documentMode>9))}();var d=!!document.createElement("canvas").getContext,o=a(window),u=(function(){return(typeof(Worker)!=="undefined")?true:false}()),n=y("Filter"),p=[],w=u&&f?new Worker(f+"BnWWorker.js"):false;var k=function(A){a(A.currentTarget).find(".BWfade").stop(true,true)[!c?"fadeIn":"fadeOut"](z)};var x=function(A){a(A.currentTarget).find(".BWfade").stop(true,true)[c?"fadeIn":"fadeOut"](z)};var l=function(){if(!p.length){return}w.postMessage(p[0].imageData);w.onmessage=function(A){p[0].ctx.putImageData(A.data,0,0);p.splice(0,1);l()}};var b=function(G,D,B,J){var K=D.getContext("2d"),E=G,F=0,H;K.drawImage(G,0,0,B,J);var A=K.getImageData(0,0,B,J),I=A.data,C=I.length;if(w){p.push({imageData:A,ctx:K})}else{for(;F<C;F+=4){H=I[F]*0.3+I[F+1]*0.59+I[F+2]*0.11;I[F]=I[F+1]=I[F+2]=H}K.putImageData(A,0,0)}};var q=function(F,D){var A=F.src,B=D.find("img"),C=B.width(),J=B.height(),E={position:"absolute",top:0,left:0,display:c?"none":"block",width:C,height:J};if(d&&!t){var I=F.width,G=F.height;a('<canvas class="BWfade" width="'+I+'" height="'+G+'"></canvas>').prependTo(D);var H=D.find("canvas");H.css(E);b(F,H[0],I,G)}else{E[y("Filter")]="grayscale(100%)";a("<img src="+A+' width="'+C+'" height="'+J+'" class="BWFilter BWfade" /> ').prependTo(D);a(".BWFilter").css(a.extend(E,{filter:"progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)"}))}};this.init=function(A){v.each(function(D,C){var B=new Image(),E=a(C);B.src=E.find("img").prop("src");if(!B.width){a(B).on("load",function(){q(B,E)})}else{q(B,E)}});if(w){l()}if(j){v.on("mouseleave",k);v.on("mouseenter",x)}if(h){o.on("resize orientationchange",v.resizeImages)}};this.resizeImages=function(){v.each(function(C,E){var B=a(E).find("img:not(.BWFilter)");var A,D;if(s){A=a(B).prop("width");D=a(B).prop("height")}else{A=a(B).width();D=a(B).height()}a(this).find(".BWFilter, canvas").css({width:A,height:D})})};return this.init(i)}})}(jQuery));
